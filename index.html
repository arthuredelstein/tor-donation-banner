<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf8"/>
  <title>Banner demo</title>
  <style>
    #banner {
      -khtml-user-select: none;    /* Konqueror */
      -moz-user-select: none;      /* Firefox */
      -ms-user-select: none;       /* Internet Explorer/Edge */
      -webkit-touch-callout: none; /* iOS Safari */
      -webkit-user-select: none;   /* Chrome/Safari/Opera */
      background-color: #406;
      background-opacity: 10%;
      background-size: cover;
      background: radial-gradient(circle, #406 90%, #203 100%);
      border-bottom:  6px solid #305;
      border-top: 5px solid #305;
      display: flex;
      height: 120px;
      justify-content: center;
      left: 0px;
      margin-top: 40px;
      opacity: 1;
      position: absolute;
      user-select: none;
      width: 100%;
    }
    #banner:before {
        background-image: url('tor-roots-only.svg');
        background-position: 50% 50%;
        background-repeat: no-repeat;
        background-size: cover;
        content: ' ';
        display: block;
        height: 100%;
        left: 0;
        opacity: 0.20;
        position: absolute;
        top: 0;
        width: 100%;
    }
    #banner-contents-container {
        align-items: center;
        display: flex;
        flex-direction: row;
        height: 100%;
        position: relative;
        width: 700px;
    }
    #banner-text {
        color: white;
        display: inline-block;
        flex-grow: 1.0;
        font-family: sans-serif;
        font-size: 48px;
        letter-spacing: -0.00em;
        margin: 0px 10px 0px 20px;
        max-height: 90%;
    }
    #banner-logo-container {
        display: inline-block;
        margin: 0px;
        position: relative;
    }
    #banner-logo {
        height: 200px;
        position: relative;
        width: 139px;
    }
    #banner-donate-button-link {
        text-decoration: none;
    }
    #banner-donate-button-link:link {
        color: #A20;
    }
    #banner-donate-button-link:hover {
        color: #C40;
    }
    #banner-donate-button-link:visited {
        color: #408;
    }
    #banner-donate-button-linka:active {
        color: black;
    }
    #banner-donate-button-container {
        background-color: #FFD;
        border-bottom-right-radius: 45px;
        border-bottom: 6px solid #204;
        border-left: 4px solid #204;
        border-right: 4px solid #204;
        border-top-right-radius: 45px;
        border-top: 4px solid #204;
        color: #A20;
        display: block;
        flex-grow: 0.0;
        height: 50px;
        letter-spacing: -0.00em;
        opacity: 100%;
        padding-bottom: 5px;
        padding-left: 15px;
        padding-right: 50px;
        padding-top: 5px;
        transform: translatey(55px);
        width: 80px;
    }
    #banner-donate-button {
        text-align: left;
        max-width: 100%;
        max-height: 100%;
        font-family: sans-serif;
        font-size: 60px;
        font-weight: bold;
        vertical-align: middle;
    }
  </style>
 </head>
 <body>
  <div id="banner" class="onions-bg">
   <div id="banner-contents-container">
    <div id="banner-logo-container">
     <img id="banner-logo" src="onion-heart.svg">
    </div>
    <div id="banner-text">
     The Tor Project needs your support to continue its work on state-of-the-art privacy!
    </div>
    <a id="banner-donate-button-link" href="https://torproject.org/donate?blah">
     <div id="banner-donate-button-container">
      <div id="banner-donate-button">
       Donate now!&nbsp;&#187;
      </div>
     </div>
    </a>
   </div>
  </div>
  <script>
    // Change the font size of text in element by ratio.
    let scaleFontBy = function (element, ratio) {
      let style = window.getComputedStyle(element),
          originalFontSize = parseFloat(style.fontSize),
          targetFontSize = originalFontSize * ratio;
      element.style.fontSize = targetFontSize + "px";
    };

    // Shrink the font size if the text in the given element is overflowing.
    let fitTextInElement = function(element) {
      element.style.fontSize = "60px";
      let style = window.getComputedStyle(element);
      if (style.whiteSpace === "nowrap") {
        // Look for horizontal overflow.
        let elementWidth = element.getBoundingClientRect().width,
            paddingWidth = parseFloat(style.paddingLeft) +
            parseFloat(style.paddingRight),
            targetWidth = elementWidth - paddingWidth,
            textWidth = element.scrollWidth;
        // Compute the appropriate font size to make the text fit.
        let ratio = targetWidth / textWidth;
        scaleFontBy(element, ratio);
      } else {
        // Look for vertical overflow.
        let elementHeight = element.clientHeight,// parentElement
                                  // .getBoundingClientRect().height,
            paddingHeight = parseFloat(style.paddingTop) +
                            parseFloat(style.paddingBottom),
            targetHeight = elementHeight - paddingHeight;
        // Wrapping causes somewhat difficult-to-predict overflow.
        // So shrink slightly and repeat.
        let ratio = 0;
        for (let i = 0; i < 100 && ratio < 1; ++i) {
          let currentHeight = element.scrollHeight;
          //console.log(`currentHeight: ${currentHeight}, targetHeight: ${targetHeight}, fontSize: ${style.fontSize}`);
          ratio = targetHeight < currentHeight ? 0.99 : 1;
          if (ratio < 1) {
            scaleFontBy(element, ratio);
          }
        }
      }
    };

    let updateTextSizes = function () {
      let bannerText = document.getElementById("banner-text");
      fitTextInElement(bannerText);
      let donateButton = document.getElementById("banner-donate-button");
      fitTextInElement(donateButton);
    }

    addEventListener("resize", updateTextSizes);
    updateTextSizes();
</script>
 </body>
</html>
